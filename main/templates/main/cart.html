{% extends "main/base.html" %}
{% load static i18n %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-6">{% trans "Корзина" %}</h1>

    {% if cart_items %}
    <div class="bg-white rounded-lg shadow overflow-hidden mb-8">
        <div class="divide-y divide-gray-200">
            {% for cart_item in cart_items %}
            <div class="p-4 flex flex-col md:flex-row items-start md:items-center">
                <div class="w-full md:w-1/4 mb-4 md:mb-0">
                    <img src="{{ cart_item.image }}" alt="{{ cart_item.product.name }}"
                         class="w-full h-auto max-h-40 object-contain">
                </div>

                <div class="w-full md:w-2/4 px-4">
                    <h3 class="font-semibold text-lg">{{ cart_item.product.name }}</h3>
                    <p class="text-gray-600">
                        {% if cart_item.product_type == 'regular' %}
                        {{ cart_item.product.category.name }}
                        {% else %}
                        {{ cart_item.product.brand }}
                        {% endif %}
                    </p>
                </div>

                <div class="w-full md:w-1/4 flex items-center justify-between mt-4 md:mt-0">
                    <div class="flex items-center">
                        <form action="{% url 'main:update_cart' cart_item.item.id %}" method="post" class="flex items-center">
                            {% csrf_token %}
                            <input type="number" name="quantity" value="{{ cart_item.item.quantity }}" min="1"
                                   class="border rounded px-3 py-1 w-16 text-center">
                            <button type="submit" class="ml-2 text-blue-600 hover:text-blue-800">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </form>
                    </div>

                    <div class="text-right">
                        <p class="font-bold">{{ cart_item.total_price }} ₽</p>
                        <a href="{% url 'main:remove_from_cart' cart_item.item.id %}"
                           class="text-red-600 hover:text-red-800 text-sm">
                            {% trans "Удалить" %}
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="p-4 bg-gray-50 border-t border-gray-200">
            <div class="flex justify-between items-center">
                <h3 class="font-semibold text-lg">{% trans "Итого" %}</h3>
                <p class="font-bold text-xl">{{ cart.total_price }} ₽</p>
            </div>
        </div>
    </div>

    <div class="flex justify-end">
        <a href="{% url 'main:checkout' %}"
           class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 transition">
            {% trans "Оформить заказ" %}
        </a>
    </div>
    {% else %}
    <div class="bg-white rounded-lg shadow p-8 text-center">
        <p class="text-gray-600 mb-4">{% trans "Ваша корзина пуста" %}</p>
        <a href="{% url 'main:home' %}"
           class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition">
            {% trans "Вернуться к покупкам" %}
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}